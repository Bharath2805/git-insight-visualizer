!function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";switch(e){case"javascript":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float";break;case"python":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <path d="M20,60 Q60,20 100,60 Q60,100 20,60" fill="#3572A5" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M45,80 Q60,70 75,80" stroke="#fff" stroke-width="3" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">PY</text>\n                        </svg>\n                    ',a="bounce";break;case"java":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="35" y="30" width="50" height="70" rx="10" fill="#b07219" />\n                            <rect x="45" y="20" width="30" height="20" rx="5" fill="#b07219" />\n                            <circle cx="40" cy="50" r="5" fill="#fff" />\n                            <circle cx="80" cy="50" r="5" fill="#fff" />\n                            <path d="M50,80 L70,80" stroke="#fff" stroke-width="3" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">JAVA</text>\n                        </svg>\n                    ',a="float";break;case"json":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="30" y="30" width="60" height="60" rx="5" fill="#5dbcd2" />\n                            <circle cx="45" cy="50" r="5" fill="#fff" />\n                            <circle cx="75" cy="50" r="5" fill="#fff" />\n                            <path d="M45,80 Q60,70 75,80" stroke="#fff" stroke-width="3" fill="none" />\n                            <text x="60" y="100" font-family="monospace" font-size="10" text-anchor="middle" fill="#5dbcd2">JSON</text>\n                        </svg>\n                    ',a="float";break;case"markdown":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="30" y="20" width="60" height="80" rx="5" fill="#083fa1" />\n                            <line x1="40" y1="40" x2="80" y2="40" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="50" x2="80" y2="50" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="60" x2="80" y2="60" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="70" x2="60" y2="70" stroke="#fff" stroke-width="2" />\n                            <circle cx="45" cy="30" r="5" fill="#fff" />\n                            <circle cx="75" cy="30" r="5" fill="#fff" />\n                            <text x="60" y="105" font-family="monospace" font-size="10" text-anchor="middle" fill="#083fa1">MD</text>\n                        </svg>\n                    ',a="float";break;default:n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"}t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this),function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";switch(e){case"javascript":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float";break;case"python":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <path d="M20,60 Q60,20 100,60 Q60,100 20,60" fill="#3572A5" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M45,80 Q60,70 75,80" stroke="#fff" stroke-width="3" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">PY</text>\n                        </svg>\n                    ',a="bounce";break;case"java":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="35" y="30" width="50" height="70" rx="10" fill="#b07219" />\n                            <rect x="45" y="20" width="30" height="20" rx="5" fill="#b07219" />\n                            <circle cx="40" cy="50" r="5" fill="#fff" />\n                            <circle cx="80" cy="50" r="5" fill="#fff" />\n                            <path d="M50,80 L70,80" stroke="#fff" stroke-width="3" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">JAVA</text>\n                        </svg>\n                    ',a="float";break;case"json":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="30" y="30" width="60" height="60" rx="5" fill="#5dbcd2" />\n                            <circle cx="45" cy="50" r="5" fill="#fff" />\n                            <circle cx="75" cy="50" r="5" fill="#fff" />\n                            <path d="M45,80 Q60,70 75,80" stroke="#fff" stroke-width="3" fill="none" />\n                            <text x="60" y="100" font-family="monospace" font-size="10" text-anchor="middle" fill="#5dbcd2">JSON</text>\n                        </svg>\n                    ',a="float";break;case"markdown":n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <rect x="30" y="20" width="60" height="80" rx="5" fill="#083fa1" />\n                            <line x1="40" y1="40" x2="80" y2="40" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="50" x2="80" y2="50" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="60" x2="80" y2="60" stroke="#fff" stroke-width="2" />\n                            <line x1="40" y1="70" x2="60" y2="70" stroke="#fff" stroke-width="2" />\n                            <circle cx="45" cy="30" r="5" fill="#fff" />\n                            <circle cx="75" cy="30" r="5" fill="#fff" />\n                            <text x="60" y="105" font-family="monospace" font-size="10" text-anchor="middle" fill="#083fa1">MD</text>\n                        </svg>\n                    ',a="float";break;default:n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"}t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this),function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";"javascript"===e?(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float"):(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"),t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this),function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";"javascript"===e?(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float"):(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"),t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this),function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";"javascript"===e?(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float"):(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"),t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this),function(e){const t={initializeAnimations:function(){try{const e=document.getElementById("logo-animation"),t=document.getElementById("loading-animation");e&&(e.innerHTML='<svg width="60" height="60" viewBox="0 0 60 60">\n                    <circle cx="30" cy="30" r="25" fill="#58a6ff">\n                        <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />\n                        <animate attributeName="opacity" values="1;0.8;1" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="30" cy="30" r="15" fill="#0d1117">\n                        <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />\n                    </circle>\n                    <path d="M20,30 L25,25 L35,35 L40,30" stroke="#58a6ff" stroke-width="3" fill="none" stroke-linecap="round">\n                        <animate attributeName="d" values="M20,30 L25,25 L35,35 L40,30;M20,30 L25,35 L35,25 L40,30;M20,30 L25,25 L35,35 L40,30" dur="3s" repeatCount="indefinite" />\n                    </path>\n                </svg>'),t&&(t.innerHTML='<svg width="100" height="100" viewBox="0 0 100 100">\n                    <circle cx="50" cy="50" r="40" stroke="#58a6ff" stroke-width="8" fill="none" stroke-linecap="round">\n                        <animate attributeName="stroke-dasharray" values="1, 250;125, 125;250, 1" dur="1.5s" repeatCount="indefinite" />\n                        <animate attributeName="stroke-dashoffset" values="0;-250;-500" dur="1.5s" repeatCount="indefinite" />\n                    </circle>\n                    <circle cx="50" cy="50" r="30" stroke="#8b949e" stroke-width="4" fill="none" stroke-dasharray="1, 150" stroke-dashoffset="0">\n                        <animate attributeName="stroke-dashoffset" values="0;150;0" dur="3s" repeatCount="indefinite" />\n                    </circle>\n                </svg>')}catch(e){}},loadLanguageAnimation:function(e){try{const t=document.getElementById("language-animation");if(!t)return;t.innerHTML="";let n="#58a6ff";switch(e){case"javascript":n="#f0db4f";break;case"python":n="#3572A5";break;case"java":n="#b07219";break;case"html":n="#e34c26";break;case"css":n="#563d7c";break;case"json":n="#5dbcd2";break;case"markdown":n="#083fa1";break;default:n="#58a6ff"}t.innerHTML=`<svg width="150" height="150" viewBox="0 0 150 150">\n                <rect x="25" y="25" width="100" height="100" fill="${n}" opacity="0.3" rx="15" ry="15">\n                    <animate attributeName="opacity" values="0.2;0.4;0.2" dur="3s" repeatCount="indefinite" />\n                </rect>\n                <rect x="45" y="45" width="60" height="60" fill="${n}" opacity="0.6" rx="10" ry="10">\n                    <animate attributeName="opacity" values="0.5;0.8;0.5" dur="2s" repeatCount="indefinite" />\n                    <animate attributeName="width" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="height" values="55;60;55" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="x" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                    <animate attributeName="y" values="47;45;47" dur="4s" repeatCount="indefinite" />\n                </rect>\n                <text x="75" y="85" font-family="monospace" font-size="16" text-anchor="middle" fill="white">${e}</text>\n            </svg>`,t.classList.add("fade-in")}catch(e){}},loadCharacterAnimation:function(e){try{const t=document.getElementById("character-container");if(!t)return;t.innerHTML="",t.classList.remove("float","bounce");let n="",a="float";"javascript"===e?(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#f0db4f" />\n                            <circle cx="40" cy="50" r="7" fill="#000" />\n                            <circle cx="80" cy="50" r="7" fill="#000" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#000" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle">JS</text>\n                        </svg>\n                    ',a="float"):(n='\n                        <svg width="120" height="120" viewBox="0 0 120 120">\n                            <circle cx="60" cy="60" r="50" fill="#58a6ff" />\n                            <circle cx="40" cy="50" r="7" fill="#fff" />\n                            <circle cx="80" cy="50" r="7" fill="#fff" />\n                            <path d="M40,75 Q60,90 80,75" stroke="#fff" stroke-width="4" fill="none" />\n                            <text x="60" y="40" font-family="monospace" font-size="10" text-anchor="middle" fill="white">CODE</text>\n                        </svg>\n                    ',a="float"),t.innerHTML=n,t.classList.add(a),t.classList.add("fade-in")}catch(e){}},showSpeechBubble:function(e,t=5e3){try{const n=document.getElementById("speech-bubble");if(!n)return;n.textContent=e,n.classList.add("active"),setTimeout((()=>{n.classList.remove("active")}),t)}catch(e){}},showLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.add("active")}catch(e){}},hideLoading:function(){try{const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}catch(e){}},playCelebration:function(e="success"){try{const e=document.getElementById("character-container");if(!e)return;e.classList.add("bounce"),setTimeout((()=>{e.classList.remove("bounce")}),1e3)}catch(e){}}};"undefined"!=typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define([],(function(){return t})),e.AnimationManager=t}("undefined"!=typeof window?window:this);const e=document.getElementById("chat-input"),t=document.getElementById("chat-submit"),n=document.getElementById("chat-body"),a=document.getElementById("explain-btn"),i=document.getElementById("explain-detail-btn");function o(e,t){const a=document.createElement("div");a.className="chat-message "+(t?"user-message":"ai-message"),t?a.textContent=e:a.innerHTML=r(e),n.appendChild(a),n.scrollTop=n.scrollHeight}function r(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function s(){const t=e.value.trim();if(!t)return;o(t,!0),e.value="";const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",n.appendChild(a),n.scrollTop=n.scrollHeight;try{let e={};window.selectedNode&&(e.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const i=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:e})});if(!i.ok)throw new Error("Failed to get response from AI");const r=await i.json();a.parentNode&&n.removeChild(a),o(r.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){a.parentNode&&n.removeChild(a),o("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function l(e=!1){const t=document.getElementById("file-path");if(!t)return;const a=t.textContent;if(!a)return;E(),o(`Explaining ${e?"in detail":""}: ${a}...`,!1);const i=document.createElement("div");i.className="chat-message ai-message typing-indicator",i.innerHTML="<span>.</span><span>.</span><span>.</span>",n.appendChild(i);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const r=t.innerText,s=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:a,fileContent:r,detailed:e})});if(!s.ok)throw new Error("Failed to get explanation from AI");const l=await s.json();i.parentNode&&n.removeChild(i),o(e?`Here's my line-by-line explanation of ${a}:`:`Here's my explanation of ${a}:`,!1),o(l.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){i.parentNode&&n.removeChild(i),o("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{k()}}function c(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&c(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{H(n,a)})),t.appendChild(e)}}}t&&t.addEventListener("click",s),e&&e.addEventListener("keyup",(e=>{"Enter"===e.key&&s()})),a&&a.addEventListener("click",(()=>{l(!1)})),i&&i.addEventListener("click",(()=>{l(!0)}));const d=document.getElementById("repo-input"),u=document.getElementById("analyze-btn"),m=document.getElementById("main-content"),f=document.getElementById("repo-title"),p=document.getElementById("repo-description"),h=document.getElementById("files-count"),y=document.getElementById("last-updated"),g=document.getElementById("loading-overlay"),w=document.getElementById("structure-btn"),v=document.getElementById("dependencies-btn"),x=document.getElementById("insights-btn");let b=null,L=null;function E(){if(g){g.classList.add("active");const e=g.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function k(){if(g){g.classList.remove("active");const e=g.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function M(e){E(),"function"==typeof o&&o("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,r=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(r),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);L=await e.json(),window.repoData=L,C(L),c(L.files),L&&L.files&&I(L),m&&(m.style.display="grid"),o(`Successfully analyzed ${n}/${a}. Found ${B(L.files)} files.`,!1)}catch(e){throw clearTimeout(r),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof o&&o(`Error analyzing repository: ${e.message}`,!1)}finally{k()}}function C(e){if(e){if(f&&(f.textContent=e.fullName||"Unknown Repository"),p&&(p.textContent=e.description||"No description available"),h){let t=B(e.files);h.textContent=`${t} files`}if(y&&e.lastUpdated){const t=new Date(e.lastUpdated);y.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function B(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=B(a.children,t));return t}function A(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function I(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",$(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=N({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const r=document.createElement("div");r.textContent=t.name,r.style.fontSize="14px",r.style.fontWeight="bold",r.style.marginBottom="5px",r.style.wordBreak="break-word";const s=document.createElement("div");s.textContent="folder"===t.type?"Folder":t.language||"Unknown",s.style.fontSize="12px",s.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(r),a.appendChild(s),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof o&&o(`Selected folder: ${t.fullPath}`,!1);else{const n=T(e.files,t.fullPath);n&&H(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function $(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&$(i.children,e,n))}return n}catch(e){return n}}function N(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function T(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function B(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=B(a.children,t));return t}function S(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=S(a.children,t));return t}function H(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${D(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function z(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function D(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),u&&u.addEventListener("click",(()=>{if(!d)return;const e=d.value.trim();e&&M(e)})),w&&w.addEventListener("click",(()=>{w.classList.add("active"),v&&v.classList.remove("active"),x&&x.classList.remove("active"),window.repoData&&window.repoData.files&&I(window.repoData)})),v&&v.addEventListener("click",(()=>{w&&w.classList.remove("active"),v.classList.add("active"),x&&x.classList.remove("active"),window.repoData&&window.repoData.files&&I(window.repoData)})),x&&x.addEventListener("click",(()=>{w&&w.classList.remove("active"),v&&v.classList.remove("active"),x.classList.add("active"),window.repoData&&window.repoData.files&&I(window.repoData)})),d&&d.addEventListener("keyup",(e=>{"Enter"===e.key&&u&&u.click()})),document.addEventListener("DOMContentLoaded",A),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",z)}));const j=document.getElementById("chat-input"),O=document.getElementById("chat-submit"),P=document.getElementById("chat-body"),q=document.getElementById("explain-btn"),R=document.getElementById("explain-detail-btn");function U(e,t){const n=document.createElement("div");n.className="chat-message "+(t?"user-message":"ai-message"),t?n.textContent=e:n.innerHTML=Y(e),P.appendChild(n),P.scrollTop=P.scrollHeight}function Y(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function F(){const e=j.value.trim();if(!e)return;U(e,!0),j.value="";const t=document.createElement("div");t.className="chat-message ai-message typing-indicator",t.innerHTML="<span>.</span><span>.</span><span>.</span>",P.appendChild(t),P.scrollTop=P.scrollHeight;try{let n={};window.selectedNode&&(n.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const a=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:n})});if(!a.ok)throw new Error("Failed to get response from AI");const i=await a.json();t.parentNode&&P.removeChild(t),U(i.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){t.parentNode&&P.removeChild(t),U("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function J(e=!1){const t=document.getElementById("file-path");if(!t)return;const n=t.textContent;if(!n)return;re(),U(`Explaining ${e?"in detail":""}: ${n}...`,!1);const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",P.appendChild(a);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const i=t.innerText,o=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n,fileContent:i,detailed:e})});if(!o.ok)throw new Error("Failed to get explanation from AI");const r=await o.json();a.parentNode&&P.removeChild(a),U(e?`Here's my line-by-line explanation of ${n}:`:`Here's my explanation of ${n}:`,!1),U(r.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){a.parentNode&&P.removeChild(a),U("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{se()}}function Q(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&Q(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{ge(n,a)})),t.appendChild(e)}}}O&&O.addEventListener("click",F),j&&j.addEventListener("keyup",(e=>{"Enter"===e.key&&F()})),q&&q.addEventListener("click",(()=>{J(!1)})),R&&R.addEventListener("click",(()=>{J(!0)}));const V=document.getElementById("repo-input"),W=document.getElementById("analyze-btn"),Z=document.getElementById("main-content"),G=document.getElementById("repo-title"),K=document.getElementById("repo-description"),X=document.getElementById("files-count"),_=document.getElementById("last-updated"),ee=document.getElementById("loading-overlay"),te=document.getElementById("structure-btn"),ne=document.getElementById("dependencies-btn"),ae=document.getElementById("insights-btn");let ie=null,oe=null;function re(){if(ee){ee.classList.add("active");const e=ee.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function se(){if(ee){ee.classList.remove("active");const e=ee.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function le(e){re(),"function"==typeof U&&U("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,o=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(o),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);oe=await e.json(),window.repoData=oe,ce(oe),Q(oe.files),oe&&oe.files&&me(oe),Z&&(Z.style.display="grid"),U(`Successfully analyzed ${n}/${a}. Found ${de(oe.files)} files.`,!1)}catch(e){throw clearTimeout(o),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof U&&U(`Error analyzing repository: ${e.message}`,!1)}finally{se()}}function ce(e){if(e){if(G&&(G.textContent=e.fullName||"Unknown Repository"),K&&(K.textContent=e.description||"No description available"),X){let t=de(e.files);X.textContent=`${t} files`}if(_&&e.lastUpdated){const t=new Date(e.lastUpdated);_.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function de(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=de(a.children,t));return t}function ue(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function me(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",fe(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=pe({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent=t.name,o.style.fontSize="14px",o.style.fontWeight="bold",o.style.marginBottom="5px",o.style.wordBreak="break-word";const r=document.createElement("div");r.textContent="folder"===t.type?"Folder":t.language||"Unknown",r.style.fontSize="12px",r.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(o),a.appendChild(r),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof U&&U(`Selected folder: ${t.fullPath}`,!1);else{const n=he(e.files,t.fullPath);n&&ge(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function fe(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&fe(i.children,e,n))}return n}catch(e){return n}}function pe(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function he(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function de(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=de(a.children,t));return t}function ye(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=ye(a.children,t));return t}function ge(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${ve(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function we(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function ve(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),W&&W.addEventListener("click",(()=>{if(!V)return;const e=V.value.trim();e&&le(e)})),te&&te.addEventListener("click",(()=>{te.classList.add("active"),ne&&ne.classList.remove("active"),ae&&ae.classList.remove("active"),window.repoData&&window.repoData.files&&me(window.repoData)})),ne&&ne.addEventListener("click",(()=>{te&&te.classList.remove("active"),ne.classList.add("active"),ae&&ae.classList.remove("active"),window.repoData&&window.repoData.files&&me(window.repoData)})),ae&&ae.addEventListener("click",(()=>{te&&te.classList.remove("active"),ne&&ne.classList.remove("active"),ae.classList.add("active"),window.repoData&&window.repoData.files&&me(window.repoData)})),V&&V.addEventListener("keyup",(e=>{"Enter"===e.key&&W&&W.click()})),document.addEventListener("DOMContentLoaded",ue),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",we)}));const xe=document.getElementById("chat-input"),be=document.getElementById("chat-submit"),Le=document.getElementById("chat-body"),Ee=document.getElementById("explain-btn"),ke=document.getElementById("explain-detail-btn");function Me(e,t){const n=document.createElement("div");n.className="chat-message "+(t?"user-message":"ai-message"),t?n.textContent=e:n.innerHTML=Ce(e),Le.appendChild(n),Le.scrollTop=Le.scrollHeight}function Ce(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function Be(){const e=xe.value.trim();if(!e)return;Me(e,!0),xe.value="";const t=document.createElement("div");t.className="chat-message ai-message typing-indicator",t.innerHTML="<span>.</span><span>.</span><span>.</span>",Le.appendChild(t),Le.scrollTop=Le.scrollHeight;try{let n={};window.selectedNode&&(n.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const a=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:n})});if(!a.ok)throw new Error("Failed to get response from AI");const i=await a.json();t.parentNode&&Le.removeChild(t),Me(i.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){t.parentNode&&Le.removeChild(t),Me("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function Ae(e=!1){const t=document.getElementById("file-path");if(!t)return;const n=t.textContent;if(!n)return;Ye(),Me(`Explaining ${e?"in detail":""}: ${n}...`,!1);const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",Le.appendChild(a);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const i=t.innerText,o=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n,fileContent:i,detailed:e})});if(!o.ok)throw new Error("Failed to get explanation from AI");const r=await o.json();a.parentNode&&Le.removeChild(a),Me(e?`Here's my line-by-line explanation of ${n}:`:`Here's my explanation of ${n}:`,!1),Me(r.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){a.parentNode&&Le.removeChild(a),Me("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{Fe()}}function Ie(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&Ie(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{et(n,a)})),t.appendChild(e)}}}be&&be.addEventListener("click",Be),xe&&xe.addEventListener("keyup",(e=>{"Enter"===e.key&&Be()})),Ee&&Ee.addEventListener("click",(()=>{Ae(!1)})),ke&&ke.addEventListener("click",(()=>{Ae(!0)}));const $e=document.getElementById("repo-input"),Ne=document.getElementById("analyze-btn"),Te=document.getElementById("main-content"),Se=document.getElementById("repo-title"),He=document.getElementById("repo-description"),ze=document.getElementById("files-count"),De=document.getElementById("last-updated"),je=document.getElementById("loading-overlay"),Oe=document.getElementById("structure-btn"),Pe=document.getElementById("dependencies-btn"),qe=document.getElementById("insights-btn");let Re=null,Ue=null;function Ye(){if(je){je.classList.add("active");const e=je.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function Fe(){if(je){je.classList.remove("active");const e=je.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function Je(e){Ye(),"function"==typeof Me&&Me("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,o=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(o),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);Ue=await e.json(),window.repoData=Ue,Qe(Ue),Ie(Ue.files),Ue&&Ue.files&&Ze(Ue),Te&&(Te.style.display="grid"),Me(`Successfully analyzed ${n}/${a}. Found ${Ve(Ue.files)} files.`,!1)}catch(e){throw clearTimeout(o),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof Me&&Me(`Error analyzing repository: ${e.message}`,!1)}finally{Fe()}}function Qe(e){if(e){if(Se&&(Se.textContent=e.fullName||"Unknown Repository"),He&&(He.textContent=e.description||"No description available"),ze){let t=Ve(e.files);ze.textContent=`${t} files`}if(De&&e.lastUpdated){const t=new Date(e.lastUpdated);De.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function Ve(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=Ve(a.children,t));return t}function We(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function Ze(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",Ge(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=Ke({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent=t.name,o.style.fontSize="14px",o.style.fontWeight="bold",o.style.marginBottom="5px",o.style.wordBreak="break-word";const r=document.createElement("div");r.textContent="folder"===t.type?"Folder":t.language||"Unknown",r.style.fontSize="12px",r.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(o),a.appendChild(r),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof Me&&Me(`Selected folder: ${t.fullPath}`,!1);else{const n=Xe(e.files,t.fullPath);n&&et(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function Ge(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&Ge(i.children,e,n))}return n}catch(e){return n}}function Ke(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function Xe(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function Ve(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=Ve(a.children,t));return t}function _e(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=_e(a.children,t));return t}function et(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${nt(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function tt(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function nt(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),Ne&&Ne.addEventListener("click",(()=>{if(!$e)return;const e=$e.value.trim();e&&Je(e)})),Oe&&Oe.addEventListener("click",(()=>{Oe.classList.add("active"),Pe&&Pe.classList.remove("active"),qe&&qe.classList.remove("active"),window.repoData&&window.repoData.files&&Ze(window.repoData)})),Pe&&Pe.addEventListener("click",(()=>{Oe&&Oe.classList.remove("active"),Pe.classList.add("active"),qe&&qe.classList.remove("active"),window.repoData&&window.repoData.files&&Ze(window.repoData)})),qe&&qe.addEventListener("click",(()=>{Oe&&Oe.classList.remove("active"),Pe&&Pe.classList.remove("active"),qe.classList.add("active"),window.repoData&&window.repoData.files&&Ze(window.repoData)})),$e&&$e.addEventListener("keyup",(e=>{"Enter"===e.key&&Ne&&Ne.click()})),document.addEventListener("DOMContentLoaded",We),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",tt)}));const at=document.getElementById("chat-input"),it=document.getElementById("chat-submit"),ot=document.getElementById("chat-body"),rt=document.getElementById("explain-btn"),st=document.getElementById("explain-detail-btn");function lt(e,t){const n=document.createElement("div");n.className="chat-message "+(t?"user-message":"ai-message"),t?n.textContent=e:n.innerHTML=ct(e),ot.appendChild(n),ot.scrollTop=ot.scrollHeight}function ct(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function dt(){const e=at.value.trim();if(!e)return;lt(e,!0),at.value="";const t=document.createElement("div");t.className="chat-message ai-message typing-indicator",t.innerHTML="<span>.</span><span>.</span><span>.</span>",ot.appendChild(t),ot.scrollTop=ot.scrollHeight;try{let n={};window.selectedNode&&(n.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const a=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:n})});if(!a.ok)throw new Error("Failed to get response from AI");const i=await a.json();t.parentNode&&ot.removeChild(t),lt(i.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){t.parentNode&&ot.removeChild(t),lt("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function ut(e=!1){const t=document.getElementById("file-path");if(!t)return;const n=t.textContent;if(!n)return;Ct(),lt(`Explaining ${e?"in detail":""}: ${n}...`,!1);const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",ot.appendChild(a);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const i=t.innerText,o=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n,fileContent:i,detailed:e})});if(!o.ok)throw new Error("Failed to get explanation from AI");const r=await o.json();a.parentNode&&ot.removeChild(a),lt(e?`Here's my line-by-line explanation of ${n}:`:`Here's my explanation of ${n}:`,!1),lt(r.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){a.parentNode&&ot.removeChild(a),lt("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{Bt()}}function mt(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&mt(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{jt(n,a)})),t.appendChild(e)}}}it&&it.addEventListener("click",dt),at&&at.addEventListener("keyup",(e=>{"Enter"===e.key&&dt()})),rt&&rt.addEventListener("click",(()=>{ut(!1)})),st&&st.addEventListener("click",(()=>{ut(!0)}));const ft=document.getElementById("repo-input"),pt=document.getElementById("analyze-btn"),ht=document.getElementById("main-content"),yt=document.getElementById("repo-title"),gt=document.getElementById("repo-description"),wt=document.getElementById("files-count"),vt=document.getElementById("last-updated"),xt=document.getElementById("loading-overlay"),bt=document.getElementById("structure-btn"),Lt=document.getElementById("dependencies-btn"),Et=document.getElementById("insights-btn");let kt=null,Mt=null;function Ct(){if(xt){xt.classList.add("active");const e=xt.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function Bt(){if(xt){xt.classList.remove("active");const e=xt.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function At(e){Ct(),"function"==typeof lt&&lt("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,o=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(o),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);Mt=await e.json(),window.repoData=Mt,It(Mt),mt(Mt.files),Mt&&Mt.files&&Tt(Mt),ht&&(ht.style.display="grid"),lt(`Successfully analyzed ${n}/${a}. Found ${$t(Mt.files)} files.`,!1)}catch(e){throw clearTimeout(o),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof lt&&lt(`Error analyzing repository: ${e.message}`,!1)}finally{Bt()}}function It(e){if(e){if(yt&&(yt.textContent=e.fullName||"Unknown Repository"),gt&&(gt.textContent=e.description||"No description available"),wt){let t=$t(e.files);wt.textContent=`${t} files`}if(vt&&e.lastUpdated){const t=new Date(e.lastUpdated);vt.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function $t(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=$t(a.children,t));return t}function Nt(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function Tt(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",St(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=Ht({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent=t.name,o.style.fontSize="14px",o.style.fontWeight="bold",o.style.marginBottom="5px",o.style.wordBreak="break-word";const r=document.createElement("div");r.textContent="folder"===t.type?"Folder":t.language||"Unknown",r.style.fontSize="12px",r.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(o),a.appendChild(r),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof lt&&lt(`Selected folder: ${t.fullPath}`,!1);else{const n=zt(e.files,t.fullPath);n&&jt(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function St(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&St(i.children,e,n))}return n}catch(e){return n}}function Ht(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function zt(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function $t(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=$t(a.children,t));return t}function Dt(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=Dt(a.children,t));return t}function jt(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${Pt(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function Ot(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function Pt(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),pt&&pt.addEventListener("click",(()=>{if(!ft)return;const e=ft.value.trim();e&&At(e)})),bt&&bt.addEventListener("click",(()=>{bt.classList.add("active"),Lt&&Lt.classList.remove("active"),Et&&Et.classList.remove("active"),window.repoData&&window.repoData.files&&Tt(window.repoData)})),Lt&&Lt.addEventListener("click",(()=>{bt&&bt.classList.remove("active"),Lt.classList.add("active"),Et&&Et.classList.remove("active"),window.repoData&&window.repoData.files&&Tt(window.repoData)})),Et&&Et.addEventListener("click",(()=>{bt&&bt.classList.remove("active"),Lt&&Lt.classList.remove("active"),Et.classList.add("active"),window.repoData&&window.repoData.files&&Tt(window.repoData)})),ft&&ft.addEventListener("keyup",(e=>{"Enter"===e.key&&pt&&pt.click()})),document.addEventListener("DOMContentLoaded",Nt),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",Ot)}));const qt=document.getElementById("chat-input"),Rt=document.getElementById("chat-submit"),Ut=document.getElementById("chat-body"),Yt=document.getElementById("explain-btn"),Ft=document.getElementById("explain-detail-btn");function Jt(e,t){const n=document.createElement("div");n.className="chat-message "+(t?"user-message":"ai-message"),t?n.textContent=e:n.innerHTML=Qt(e),Ut.appendChild(n),Ut.scrollTop=Ut.scrollHeight}function Qt(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function Vt(){const e=qt.value.trim();if(!e)return;Jt(e,!0),qt.value="";const t=document.createElement("div");t.className="chat-message ai-message typing-indicator",t.innerHTML="<span>.</span><span>.</span><span>.</span>",Ut.appendChild(t),Ut.scrollTop=Ut.scrollHeight;try{let n={};window.selectedNode&&(n.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const a=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:n})});if(!a.ok)throw new Error("Failed to get response from AI");const i=await a.json();t.parentNode&&Ut.removeChild(t),Jt(i.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){t.parentNode&&Ut.removeChild(t),Jt("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function Wt(e=!1){const t=document.getElementById("file-path");if(!t)return;const n=t.textContent;if(!n)return;dn(),Jt(`Explaining ${e?"in detail":""}: ${n}...`,!1);const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",Ut.appendChild(a);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const i=t.innerText,o=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n,fileContent:i,detailed:e})});if(!o.ok)throw new Error("Failed to get explanation from AI");const r=await o.json();a.parentNode&&Ut.removeChild(a),Jt(e?`Here's my line-by-line explanation of ${n}:`:`Here's my explanation of ${n}:`,!1),Jt(r.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){a.parentNode&&Ut.removeChild(a),Jt("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{un()}}function Zt(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&Zt(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{bn(n,a)})),t.appendChild(e)}}}Rt&&Rt.addEventListener("click",Vt),qt&&qt.addEventListener("keyup",(e=>{"Enter"===e.key&&Vt()})),Yt&&Yt.addEventListener("click",(()=>{Wt(!1)})),Ft&&Ft.addEventListener("click",(()=>{Wt(!0)}));const Gt=document.getElementById("repo-input"),Kt=document.getElementById("analyze-btn"),Xt=document.getElementById("main-content"),_t=document.getElementById("repo-title"),en=document.getElementById("repo-description"),tn=document.getElementById("files-count"),nn=document.getElementById("last-updated"),an=document.getElementById("loading-overlay"),on=document.getElementById("structure-btn"),rn=document.getElementById("dependencies-btn"),sn=document.getElementById("insights-btn");let ln=null,cn=null;function dn(){if(an){an.classList.add("active");const e=an.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function un(){if(an){an.classList.remove("active");const e=an.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function mn(e){dn(),"function"==typeof Jt&&Jt("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,o=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(o),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);cn=await e.json(),window.repoData=cn,fn(cn),Zt(cn.files),cn&&cn.files&&yn(cn),Xt&&(Xt.style.display="grid"),Jt(`Successfully analyzed ${n}/${a}. Found ${pn(cn.files)} files.`,!1)}catch(e){throw clearTimeout(o),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof Jt&&Jt(`Error analyzing repository: ${e.message}`,!1)}finally{un()}}function fn(e){if(e){if(_t&&(_t.textContent=e.fullName||"Unknown Repository"),en&&(en.textContent=e.description||"No description available"),tn){let t=pn(e.files);tn.textContent=`${t} files`}if(nn&&e.lastUpdated){const t=new Date(e.lastUpdated);nn.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function pn(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=pn(a.children,t));return t}function hn(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function yn(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",gn(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=wn({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent=t.name,o.style.fontSize="14px",o.style.fontWeight="bold",o.style.marginBottom="5px",o.style.wordBreak="break-word";const r=document.createElement("div");r.textContent="folder"===t.type?"Folder":t.language||"Unknown",r.style.fontSize="12px",r.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(o),a.appendChild(r),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof Jt&&Jt(`Selected folder: ${t.fullPath}`,!1);else{const n=vn(e.files,t.fullPath);n&&bn(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function gn(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&gn(i.children,e,n))}return n}catch(e){return n}}function wn(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function vn(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function pn(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=pn(a.children,t));return t}function xn(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=xn(a.children,t));return t}function bn(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${En(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function Ln(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function En(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),Kt&&Kt.addEventListener("click",(()=>{if(!Gt)return;const e=Gt.value.trim();e&&mn(e)})),on&&on.addEventListener("click",(()=>{on.classList.add("active"),rn&&rn.classList.remove("active"),sn&&sn.classList.remove("active"),window.repoData&&window.repoData.files&&yn(window.repoData)})),rn&&rn.addEventListener("click",(()=>{on&&on.classList.remove("active"),rn.classList.add("active"),sn&&sn.classList.remove("active"),window.repoData&&window.repoData.files&&yn(window.repoData)})),sn&&sn.addEventListener("click",(()=>{on&&on.classList.remove("active"),rn&&rn.classList.remove("active"),sn.classList.add("active"),window.repoData&&window.repoData.files&&yn(window.repoData)})),Gt&&Gt.addEventListener("keyup",(e=>{"Enter"===e.key&&Kt&&Kt.click()})),document.addEventListener("DOMContentLoaded",hn),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",Ln)}));const kn=document.getElementById("chat-input"),Mn=document.getElementById("chat-submit"),Cn=document.getElementById("chat-body"),Bn=document.getElementById("explain-btn"),An=document.getElementById("explain-detail-btn");function In(e,t){const n=document.createElement("div");n.className="chat-message "+(t?"user-message":"ai-message"),t?n.textContent=e:n.innerHTML=$n(e),Cn.appendChild(n),Cn.scrollTop=Cn.scrollHeight}function $n(e){if(e.includes("function")&&e.includes("Lines")){let t='<div class="code-analysis">';const n=e.split(/Lines \d+-\d+/),a=e.match(/Lines \d+-\d+/g)||[];if(a.length>0){t+='<h3 class="analysis-header">Code Analysis Summary</h3>';for(let e=0;e<a.length;e++)t+='<div class="analysis-section">',t+=`<div class="section-header">${a[e]}</div>`,n[e+1]&&(t+=`<div class="section-content">${n[e+1]}</div>`),t+="</div>"}else t+=e;return t+="</div>",t}let t=e;return t=t.replace(/```([a-z]*)([\s\S]*?)```/g,((e,t,n)=>`<div class="code-block"><div class="code-header">${t||"code"}</div><pre class="code-content language-${t||"none"}">${n.trim()}</pre></div>`)),t=t.replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)(?!\s*<li>)/gs,"<ul>$1</ul>"),t=t.replace(/^#{1,6}\s+(.+)$/gm,((e,t)=>{const n=e.trim().indexOf(" ");return`<h${n} class="chat-heading">${t}</h${n}>`})),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t}async function Nn(){const e=kn.value.trim();if(!e)return;In(e,!0),kn.value="";const t=document.createElement("div");t.className="chat-message ai-message typing-indicator",t.innerHTML="<span>.</span><span>.</span><span>.</span>",Cn.appendChild(t),Cn.scrollTop=Cn.scrollHeight;try{let n={};window.selectedNode&&(n.selectedNode={id:window.selectedNode.id,type:window.selectedNode.type,language:window.selectedNode.language,outdated:window.selectedNode.outdated});const a=await fetch("/api/openai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,repoData:window.repoData?{name:window.repoData.name,fullName:window.repoData.fullName,description:window.repoData.description}:null,context:n})});if(!a.ok)throw new Error("Failed to get response from AI");const i=await a.json();t.parentNode&&Cn.removeChild(t),In(i.response,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble("I've answered your question in the chat below!")}catch(e){t.parentNode&&Cn.removeChild(t),In("Sorry, I encountered an error while processing your request. Please try again.",!1)}}async function Tn(e=!1){const t=document.getElementById("file-path");if(!t)return;const n=t.textContent;if(!n)return;Vn(),In(`Explaining ${e?"in detail":""}: ${n}...`,!1);const a=document.createElement("div");a.className="chat-message ai-message typing-indicator",a.innerHTML="<span>.</span><span>.</span><span>.</span>",Cn.appendChild(a);try{const t=document.getElementById("code-content");if(!t)throw new Error("Code content element not found");const i=t.innerText,o=await fetch("/api/openai/explain-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n,fileContent:i,detailed:e})});if(!o.ok)throw new Error("Failed to get explanation from AI");const r=await o.json();a.parentNode&&Cn.removeChild(a),In(e?`Here's my line-by-line explanation of ${n}:`:`Here's my explanation of ${n}:`,!1),In(r.explanation,!1),window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(e?"I've analyzed this file line by line! Check the chat for details.":"I've analyzed this file! Check the chat for a summary.")}catch(e){a.parentNode&&Cn.removeChild(a),In("Sorry, I encountered an error while analyzing this file. Please try again.",!1)}finally{Wn()}}function Sn(e,t=document.getElementById("file-tree")){if(t&&e){t.innerHTML="";for(const[n,a]of Object.entries(e))if("folder"===a.type){const e=document.createElement("div");e.className="folder",e.innerHTML=`\n                <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M1 5v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5"></path>\n                    <path d="M1 5a1 1 0 0 1 1-1h4l2 2h6a1 1 0 0 1 1 1v1"></path>\n                </svg>\n                <span class="folder-name">${n}</span>\n            `;const i=document.createElement("div");i.className="folder-content",a.children&&Sn(a.children,i),e.addEventListener("click",(t=>{t.stopPropagation(),e.classList.toggle("open")})),e.appendChild(i),t.appendChild(e)}else if("file"===a.type){const e=document.createElement("div");let i;switch(e.className="file",a.language){case"javascript":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f0883e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 19l-7-7 7-7"></path>\n                        <path d="M19 5v14"></path>\n                    </svg>';break;case"python":i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#58a6ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M12 5.5v8M5.5 12h13"></path>\n                        <path d="M6 4v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2Z"></path>\n                    </svg>';break;default:i='<svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#8b949e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>\n                            <path d="M14 2v6h6"></path>\n                            <path d="M16 13H8"></path>\n                            <path d="M16 17H8"></path>\n                            <path d="M10 9H8"></path>\n                        </svg>'}e.innerHTML=`\n                    ${i}\n                    <span class="file-name language-${a.language}">${n}</span>\n                    ${a.outdated?'<span class="outdated-badge">Outdated</span>':""}\n                `,e.addEventListener("click",(()=>{ia(n,a)})),t.appendChild(e)}}}Mn&&Mn.addEventListener("click",Nn),kn&&kn.addEventListener("keyup",(e=>{"Enter"===e.key&&Nn()})),Bn&&Bn.addEventListener("click",(()=>{Tn(!1)})),An&&An.addEventListener("click",(()=>{Tn(!0)}));const Hn=document.getElementById("repo-input"),zn=document.getElementById("analyze-btn"),Dn=document.getElementById("main-content"),jn=document.getElementById("repo-title"),On=document.getElementById("repo-description"),Pn=document.getElementById("files-count"),qn=document.getElementById("last-updated"),Rn=document.getElementById("loading-overlay"),Un=document.getElementById("structure-btn"),Yn=document.getElementById("dependencies-btn"),Fn=document.getElementById("insights-btn");let Jn=null,Qn=null;function Vn(){if(Rn){Rn.classList.add("active");const e=Rn.querySelector(".loading-message");e&&(e.textContent="Analyzing repository... Please wait.")}}function Wn(){if(Rn){Rn.classList.remove("active");const e=Rn.querySelector(".loading-message");e&&(e.textContent="Ready to analyze repositories...")}}async function Zn(e){Vn(),"function"==typeof In&&In("Analyzing repository... Please wait while I fetch the data.",!1);try{const t=e.replace("https://github.com/","").split("/"),n=t[0],a=t[1];if(!n||!a)throw new Error("Invalid repository URL format. Please use format: https://github.com/username/repository");const i=new AbortController,o=setTimeout((()=>i.abort()),12e4);try{const e=await fetch(`/api/github/repo?owner=${n}&repo=${a}`,{signal:i.signal});if(clearTimeout(o),!e.ok)throw new Error(`API error: ${e.status} ${e.statusText}`);Qn=await e.json(),window.repoData=Qn,Gn(Qn),Sn(Qn.files),Qn&&Qn.files&&_n(Qn),Dn&&(Dn.style.display="grid"),In(`Successfully analyzed ${n}/${a}. Found ${Kn(Qn.files)} files.`,!1)}catch(e){throw clearTimeout(o),"AbortError"===e.name?new Error("Repository analysis timed out. This repository may be too large to process. Try a smaller repository."):e}}catch(e){"function"==typeof In&&In(`Error analyzing repository: ${e.message}`,!1)}finally{Wn()}}function Gn(e){if(e){if(jn&&(jn.textContent=e.fullName||"Unknown Repository"),On&&(On.textContent=e.description||"No description available"),Pn){let t=Kn(e.files);Pn.textContent=`${t} files`}if(qn&&e.lastUpdated){const t=new Date(e.lastUpdated);qn.textContent=`Last updated: ${t.toLocaleDateString()}`}}}function Kn(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=Kn(a.children,t));return t}function Xn(){try{const e=localStorage.getItem("theme");e&&(document.body.className=e,document.querySelectorAll(".theme-btn").forEach((t=>{t.classList.remove("active"),t.dataset.theme===e&&t.classList.add("active")}))),void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations?window.AnimationManager.initializeAnimations():setTimeout((()=>{void 0!==window.AnimationManager&&"function"==typeof window.AnimationManager.initializeAnimations&&window.AnimationManager.initializeAnimations()}),500)}catch(e){}}function _n(e){if(!e)return;if(!e.files)return;const t=document.getElementById("visualization-container");if(!t)return;t.innerHTML="";const n=document.createElement("div");n.className="file-grid",n.style.display="grid",n.style.gridTemplateColumns="repeat(auto-fill, minmax(150px, 1fr))",n.style.gap="15px",n.style.padding="20px",n.style.overflowY="auto",n.style.height="100%",ea(e.files).forEach((t=>{const a=document.createElement("div");a.className="file-card",a.style.backgroundColor="var(--bg-secondary)",a.style.borderRadius="8px",a.style.padding="15px",a.style.border="1px solid var(--border-color)",a.style.cursor="pointer",a.style.transition="transform 0.2s, box-shadow 0.2s";const i=document.createElement("div");i.style.height="8px",i.style.width="100%",i.style.backgroundColor=ta({language:t.language,type:t.type}),i.style.borderRadius="4px 4px 0 0",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent=t.name,o.style.fontSize="14px",o.style.fontWeight="bold",o.style.marginBottom="5px",o.style.wordBreak="break-word";const r=document.createElement("div");r.textContent="folder"===t.type?"Folder":t.language||"Unknown",r.style.fontSize="12px",r.style.color="var(--text-secondary)",a.appendChild(i),a.appendChild(o),a.appendChild(r),a.addEventListener("mouseover",(()=>{if(a.style.transform="translateY(-5px)",a.style.boxShadow="0 5px 15px var(--shadow-color)",window.AnimationManager&&"function"==typeof window.AnimationManager.showSpeechBubble){const e="folder"===t.type?`This is the ${t.name} folder`:`This is a ${t.language||"unknown"} file: ${t.name}`;window.AnimationManager.showSpeechBubble(e)}})),a.addEventListener("mouseout",(()=>{a.style.transform="translateY(0)",a.style.boxShadow="none"})),a.addEventListener("click",(()=>{if("folder"===t.type)"function"==typeof In&&In(`Selected folder: ${t.fullPath}`,!1);else{const n=na(e.files,t.fullPath);n&&ia(t.fullPath,n)}})),n.appendChild(a)})),t.appendChild(n),window.selectedNode=null}function ea(e,t="",n=[]){if(!e)return n;try{for(const[a,i]of Object.entries(e)){const e=t?`${t}/${a}`:a;"file"===i.type?n.push({name:a,type:"file",language:i.language,fullPath:e,outdated:i.outdated}):"folder"===i.type&&(n.push({name:a,type:"folder",fullPath:e}),i.children&&ea(i.children,e,n))}return n}catch(e){return n}}function ta(e){if(!e)return"var(--text-secondary)";try{if("folder"===e.type)return"var(--accent-orange)";if(e.outdated)return"var(--accent-red)";switch(e.language){case"javascript":return"var(--accent-orange)";case"python":case"json":return"var(--accent-blue)";case"java":return"var(--accent-red)";case"html":case"markdown":return"var(--accent-green)";case"css":return"var(--accent-purple)";default:return"var(--text-secondary)"}}catch(e){return"var(--text-secondary)"}}function na(e,t){if(!e||!t)return null;try{const n=t.split("/");let a=e;for(let e=0;e<n.length;e++){const t=n[e];if(e===n.length-1)return a[t];if(!a[t]||"folder"!==a[t].type)return null;a=a[t].children}}catch(e){}return null}function Kn(e,t=0){if(!e)return t;for(const[n,a]of Object.entries(e))"file"===a.type?t++:"folder"===a.type&&a.children&&(t=Kn(a.children,t));return t}function aa(e,t={}){if(!e)return t;for(const[n,a]of Object.entries(e))if("file"===a.type){const e=a.language||"unknown";t[e]=(t[e]||0)+1}else"folder"===a.type&&a.children&&(t=aa(a.children,t));return t}function ia(e,t){const n=document.getElementById("file-path"),a=document.getElementById("code-content"),i=document.getElementById("code-viewer"),o=document.querySelector(".visualization-container").parentElement;n&&a&&i&&o&&t&&t.content&&(n.textContent=e,a.innerHTML="",t.content.split("\n").forEach(((e,t)=>{const n=document.createElement("div");n.className="code-line",n.innerHTML=`\n            <span class="line-number">${t+1}</span>\n            <span class="line-content">${ra(e)}</span>\n        `,a.appendChild(n)})),window.AnimationManager&&("function"==typeof window.AnimationManager.loadLanguageAnimation&&window.AnimationManager.loadLanguageAnimation(t.language),"function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation(t.language),"function"==typeof window.AnimationManager.showSpeechBubble&&window.AnimationManager.showSpeechBubble(`This is a ${t.language} file named ${e}. I can explain it if you ask me!`)),o.style.display="none",i.style.display="flex",window.selectedNode={id:e,type:"file",language:t.language,outdated:t.outdated})}function oa(){const e=document.getElementById("code-viewer"),t=document.querySelector(".visualization-container").parentElement;e&&t&&(e.style.display="none",t.style.display="block",window.AnimationManager&&("function"==typeof window.AnimationManager.loadCharacterAnimation&&window.AnimationManager.loadCharacterAnimation("general"),"function"==typeof window.AnimationManager.removeLanguageAnimation&&window.AnimationManager.removeLanguageAnimation()),window.selectedNode=null)}function ra(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("loading-overlay");if(e){const t=document.getElementById("loading-animation");t.innerHTML||(t.innerHTML='\n                <div class="manual-spinner" style="width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); \n                 border-radius: 50%; border-top-color: var(--accent-blue); \n                 animation: spin 1s ease-in-out infinite;"></div>\n                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n            ');let n=e.querySelector(".loading-message");n||(n=document.createElement("div"),n.className="loading-message",n.textContent="Ready to analyze repositories...",n.style.color="var(--text-primary)",n.style.marginTop="20px",n.style.textAlign="center",e.appendChild(n))}const t=document.querySelector(".chat-container");if(t){t.style.display="flex",t.style.flexDirection="column",t.style.flex="1",t.style.maxHeight="none",t.style.height="100%";const e=document.querySelector(".chat-body");e&&(e.style.flex="1",e.style.maxHeight="none",e.style.overflowY="auto");const n=document.querySelector(".visualization-panel");n&&(n.style.gridTemplateRows="auto minmax(200px, 1fr) minmax(200px, 1fr)")}})),zn&&zn.addEventListener("click",(()=>{if(!Hn)return;const e=Hn.value.trim();e&&Zn(e)})),Un&&Un.addEventListener("click",(()=>{Un.classList.add("active"),Yn&&Yn.classList.remove("active"),Fn&&Fn.classList.remove("active"),window.repoData&&window.repoData.files&&_n(window.repoData)})),Yn&&Yn.addEventListener("click",(()=>{Un&&Un.classList.remove("active"),Yn.classList.add("active"),Fn&&Fn.classList.remove("active"),window.repoData&&window.repoData.files&&_n(window.repoData)})),Fn&&Fn.addEventListener("click",(()=>{Un&&Un.classList.remove("active"),Yn&&Yn.classList.remove("active"),Fn.classList.add("active"),window.repoData&&window.repoData.files&&_n(window.repoData)})),Hn&&Hn.addEventListener("keyup",(e=>{"Enter"===e.key&&zn&&zn.click()})),document.addEventListener("DOMContentLoaded",Xn),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".theme-btn");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),document.body.classList.remove("theme-dark","theme-cyberpunk","theme-forest","theme-sunset"),document.body.classList.add(t.dataset.theme),localStorage.setItem("theme",t.dataset.theme)}))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("close-code-btn");e&&e.addEventListener("click",oa)}));